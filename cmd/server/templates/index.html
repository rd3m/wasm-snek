<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Snek</title>
		<link rel="stylesheet" href="https://unpkg.com/tailwindcss@3.3.2/src/css/preflight.css" />
	</head>
	<body>
		<div style="display: grid; align-items: center; width: 100%; height: 100vh">
			<div style="display: flex; justify-content: space-between; padding: 0 1rem">
				<h1 style="font-size: 1.875rem">Snek</h1>
				<h2 id="score">0</h2>
			</div>
			<canvas id="canvas" style="width: 100%; height: 100%; border: 2px solid black"></canvas>
		</div>
		<script src="/wasm/wasm_exec.js"></script>
		<script>
			async function runWasm() {
				const go = new Go();
				go.exit = (code) => {
					if (code !== 0) {
						const username = prompt("Game Over! Please enter your name to save your score:");
						if (username !== null) {
							fetch("/saveScore", {
								method: "POST",
								headers: {
									"Content-Type": "application/x-www-form-urlencoded",
								},
								body: `name=${encodeURIComponent(username)}&score=${encodeURIComponent(finalScore)}`,
							})
								.then((response) => response.json())
								.then((data) => {
									console.log(data);
									window.location.href = "/scores";
								})
								.catch((error) => {
									console.error("Error:", error);
								});
						}
					}
				};

				const result = await WebAssembly.instantiateStreaming(fetch("/wasm/main.wasm"), go.importObject);
				go.run(result.instance);
			}

			runWasm();
		</script>
	</body>
</html>
