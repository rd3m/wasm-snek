{{ template "header" . }}
<div class="flex gap-4 px-4">
	<h2 class="text-3xl">Score:</h2>
	<h2 id="score" class="text-3xl">0</h2>
</div>
<canvas id="canvas" class="w-full h-full bg-neutral"></canvas>
<script src="/wasm/wasm_exec.js"></script>
<script>
	async function runWasm() {
		const go = new Go();
		go.exit = (code) => {
			if (code !== 0) {
				const username = prompt("Game Over! Please enter your name to save your score:");
				if (username !== null) {
					fetch("/saveScore", {
						method: "POST",
						headers: {
							"Content-Type": "application/x-www-form-urlencoded",
						},
						body: `name=${encodeURIComponent(username)}&score=${encodeURIComponent(finalScore)}`,
					})
						.then((response) => response.json())
						.then((data) => {
							console.log(data);
							window.location.href = "/scores";
						})
						.catch((error) => {
							console.error("Error:", error);
						});
				}
			}
		};

		const result = await WebAssembly.instantiateStreaming(fetch("/wasm/main.wasm"), go.importObject);
		go.run(result.instance);
	}

	runWasm();
</script>
{{ template "footer" . }}
